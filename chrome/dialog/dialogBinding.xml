<?xml version="1.0"?>
<!DOCTYPE bindings >

<bindings id="pinterest-bindings"
          xmlns="http://www.mozilla.org/xbl"
          xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:html="http://www.w3.org/1999/xhtml">
<binding id="pinterest-overlay" inheritstyle="false">
  <resources>
    <stylesheet src="resource://pinterest-context/dialog.css" />
  </resources>
  <content>
    <html:div class="backdrop" />
    <html:div class="pinterest-context-dialog">
      <html:div class="pinterest-context-dialog-header">
        <html:h2 class="pinterest-context-dialog-header-text">Loading...</html:h2>
        <html:a class="pinterest-context-dialog-close">
          <html:span />
        </html:a>
      </html:div>
      <html:div class="blah">
        <html:iframe class="pinterest-context-dialog-frame" />
      </html:div>
    </html:div>
  </content>
  <implementation>
    <constructor>
      let self = this;

      // Add close handlers
      // TODO: Code cleanup!
      function closeDialog() {
        document.body.removeChild(self);
        document.removeEventListener("keypress", escapeHandler, true);
      }

      function escapeHandler(aEvent) {
        if (aEvent.keyCode == 27) { // escape key-code
          closeDialog();
          aEvent.stopPropagation();
        }
      };
      document.addEventListener("keypress", escapeHandler, true);

      let closeButton = document.getAnonymousElementByAttribute(
        this, "class", "pinterest-context-dialog-close");
      closeButton.addEventListener("click", closeDialog);

      let backdrop = document.getAnonymousElementByAttribute(
        this, "class", "backdrop");
      backdrop.addEventListener("click", closeDialog);

      let frame = document.getAnonymousElementByAttribute(
        this, "class", "pinterest-context-dialog-frame");
      frame.setAttribute("src", this.getAttribute("createpath"));

      let growingBody = document.getAnonymousElementByAttribute(
        this, "class", "growing-body");
      let headerText = document.getAnonymousElementByAttribute(
        this, "class", "pinterest-context-dialog-header-text");

      frame.addEventListener("load", function(aEvent) {
        // Triggers expanding height CSS animation
        frame.style.display = "block";
        growingBody.style.height = frame.clientHeight + "px";

        // Change header text from loading to title
        // TODO: Localization!
        headerText.textContent = "Add a Pin";
      });
    </constructor>
    <field name="createpath" />
  </implementation>
</binding>
</bindings>
